<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Search - James Willard Schultz Collection, Montana State University (MSU) Library</title>
  <link rel="stylesheet" href="./styles.css">
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" type="image/png" href="./img/icons/favicon.png">
  <meta name="theme-color" content="#213c69" />
  <meta name="description" content="Progressive Web App Template for digital collections using James Willard Schultz Photos & Personal Papers Collection at Montana State University (MSU) Library. James Willard Schultz Photos & Personal Papers Collection includes photos & documents of Blackfeet, Blood, Kootenai, Shoshone and Arapaho Native Americans, Glacier and Waterton Lakes National Parks, as well as his professional writing career and personal papers.">
  <!-- iOS -->
  <link rel="apple-touch-icon" href="./img/icons/icon-144x144.png" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-status-bar-style" content="black" />
  <meta name="mobile-web-app-title" content="SchultzPWA">
</head>
<body>
  <header>
    <h1>James Willard Schultz Collection</h1>
  </header>
  <nav>
    <a href="./search.html">Search</a>
    <a href="./index.html#browse">Browse</a>
    <a href="./about.html">About</a>
  </nav>
  <div class="alert" role="alert" hidden>Your browser does not support ServiceWorker. The app will not be available offline.</div>
  <main>
    <h2 id="speakers">Search James Willard Schultz Collection</h2>
    <form action="./search.html" class="search-form" id="search-form" method="get">
      <label class="hidden" for="search-box">Search</label>
      <input class="text" type="text" id="search-term" name="q" maxlength="75" placeholder="Keywords, title..."/>
      <input class="submit" type="submit" value="Search" />
    </form>
    <p id="search-message"></p>
    <ol id="search-results"></ol>
  </main>
  <footer>
    <p>Â© Copyright Montana State University (MSU) Library</p>
    <p>
      Created by
      <a href="https://twitter.com/jaclark">@jaclark</a>, the source code is available on
      <a href="https://github.com/jasonclark">GitHub</a>.
    </p>
  </footer>
  <script src="./app.js"></script>
  <script>
  function getQueryVariable(variable) {
    const query = window.location.search.substring(1);
    const vars = query.split('&');

    for (let i = 0; i < vars.length; i++) {
      const pair = vars[i].split('=');

      if (pair[0] === variable) {
        return decodeURIComponent(pair[1].replace(/\+/g, '%20'));
      }
    }
  }

  // use fetch to retrieve json file and report any errors that occur
  fetch('./items.json').then(response => {
    if (response.ok) {
      response.json().then(json => {
        data = json;

        document.getElementById("search-form").onsubmit = () => {
          document.getElementById("search-message").innerHTML = "";
          document.getElementById("search-results").innerHTML = "";
          searchterm = document.getElementById("search-term").value || getQueryVariable('q');
          searchtermlower = searchterm.toLowerCase();
          searchtermlength = searchterm.length;
          j = 0;

          for (i = 0; i < data.length; i++) {
            datalower = (data[i].item.titleInfo_title).toLowerCase();

            if (datalower.includes(searchtermlower)) {
              document.getElementById("search-results").innerHTML += `<li><a href="./item.html?id=${data[i].item.recordInfo_recordIdentifier}"><img alt="${data[i].item.titleInfo_title}" src="${data[i].item.identifier}" /></a><p>${data[i].item.titleInfo_title}</p><p>${data[i].item.abstract}</p><p>${data[i].item.extension}</p><p>${data[i].item.originInfo_dateIssued}</p></li>`;
              j++;
            }
          }

          document.getElementById("search-message").innerHTML += `Your search for <em>${searchterm}</em> has ${j} result(s)`;
          return false;
        }
      });
    } else {
      console.log(`Request for items.json failed with response ${response.status}: ${response.statusText}`);
    }
  });
  </script>
</body>
</html>