<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <title>Item - James Willard Schultz Collection, Montana State University (MSU) Library</title>
  <link rel="stylesheet" href="./styles.css" media="print" onload="this.media='all'"/>
  <link rel="manifest" href="./manifest.json"/>
  <link rel="icon" type="image/png" href="./img/icons/favicon.png"/>
  <link rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/us/"/>
  <meta name="theme-color" content="#213c69"/>
  <meta name="description" content="Item page view within Progressive Web App Template for digital collections using James Willard Schultz Photos & Personal Papers Collection at Montana State University (MSU) Library. James Willard Schultz Photos & Personal Papers Collection includes photos & documents of Blackfeet, Blood, Kootenai, Shoshone and Arapaho Native Americans, Glacier and Waterton Lakes National Parks, as well as his professional writing career and personal papers."/>
  <!-- iOS -->
  <link rel="apple-touch-icon" href="./img/icons/icon-144x144.png"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="mobile-web-app-status-bar-style" content="black"/>
  <meta name="mobile-web-app-title" content="SchultzPWA"/>
</head>
<body>
  <header role="banner">
    <h1>James Willard Schultz Collection</h1>
  </header>
  <nav role="navigation">
    <a href="./search.html">Search</a>
    <a href="./index.html#browse">Browse</a>
    <a href="./about.html">About</a>
  </nav>
  <div class="alert" role="alert" hidden>Your browser does not support ServiceWorker. The app will not be available offline.</div>
  <main aria-live="polite" class="item" role="main">
    <div class="loader" hidden>Loading...</div>
  </main>
  <footer role="contentinfo">
    <p>Â© Copyright Montana State University (MSU) Library</p>
    <p>
      Created by
      <a href="https://twitter.com/jaclark">@jaclark</a>, the source code is available on
      <a href="https://github.com/jasonclark">GitHub</a>.
    </p>
  </footer>
  <script src="./app.js"></script>
  <script>
  //set canonical link
  let link = document.createElement('link');
  link.setAttribute('rel', 'canonical');
  link.setAttribute('href', location.protocol + '//' + location.host + location.pathname + '?' + location.search.substring(1));
  document.head.appendChild(link);

  function getQueryVariable(variable) {
    const query = window.location.search.substring(1);
    const vars = query.split('&');

    for (let i = 0; i < vars.length; i++) {
      const pair = vars[i].split('=');

      if (pair[0] === variable) {
        return decodeURIComponent(pair[1].replace(/\+/g, '%20'));
      }
    }
  }

  // use fetch to retrieve json file and report any errors that occur
  fetch('./items.json').then(response => {
    if (response.ok) {
      response.json().then(json => {
        data = json;

        document.querySelector('.item').innerHTML = "";
        const queryID = Number(getQueryVariable('id'));
          
          if (Number.isNaN(queryID)) {
            document.querySelector('.item').innerHTML += `
            <h2>Error in finding item!</h2>
            <p>Query type not supported.</p>
            `;
          }

          for (i = 0; i < data.length; i++) {
            let itemID = Number(data[i].item.recordInfo_recordIdentifier);
            //get filename from identifier -> unique given this data in items.json
            let urlPath = data[i].item.identifier;
            let fileName = urlPath.substring(urlPath.lastIndexOf('/')+1).split('-').pop();

            if (itemID === queryID) {
              document.querySelector('.item').innerHTML += `
              <h2>${data[i].item.titleInfo_title}</h2>
              <ul class="item">
              <li>
                <img alt="${data[i].item.titleInfo_title}" src="${data[i].item.identifier}" />
                <p>${data[i].item.titleInfo_title}</p>
                <p>${data[i].item.abstract}</p>
                <p>${data[i].item.extension}</p>
                <p>${data[i].item.originInfo_dateIssued}</p>
                <p>Record ID: ${data[i].item.recordInfo_recordIdentifier}</p>
                <a class="quality" href="https://arc.lib.montana.edu/schultz-0010/objects/hres-${fileName}">Object view</a>
              </li>
              </ul>
              `;
            }
          }
      });
    } 
  });
  </script>
</body>
</html>
